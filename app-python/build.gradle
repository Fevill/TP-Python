version = '2.0'
def tarfile = "application-" + version
 
// Supprimer le dossier build
task purge(type:Delete) {
  //println 'Cleaning up old files'
  delete 'build'
}

// Archiver le dossier source
task packageDistribution(type: Zip, dependsOn: purge) {
    from ('src') { into '.' }
    archiveFileName = tarfile + ".zip"
    destinationDirectory = file("build")
}

// Deposer l'archive sur nexus
task up(type:Exec, dependsOn: packageDistribution) {
 executable 'sh'
 args '-c', 'curl -v --user "admin:O7c8ujY4UXvl2znB4bDj" --upload-file build/application-'+version+'.zip http://192.168.0.12:8081/repository/TpPython/gapplication-python/application-'+version+'.zip'
 standardOutput = new ByteArrayOutputStream()
 ext.output = { return standardOutput.toString() }
}